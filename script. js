const STORAGE_KEY = 'scribbleContent';

const scribbleArea = document.getElementById('ScribbleSpace');
const clearButton = document.getElementById('clearButton');
const saveButton = document.getElementById('saveButton');

function loadContent() {
    chrome.storage.local.get(STORAGE_KEY, function(result) {
        if (result[STORAGE_KEY]) {
            scribbleArea.value = result[STORAGE_KEY];
        }
    });
}

function saveContent() {
    const content = scribbleArea.value;
    chrome.storage.local.set({ [STORAGE_KEY]: content });
}

function clearContent() {
    scribbleArea.value = '';
    chrome.storage.local.remove(STORAGE_KEY);
    scribbleArea.focus();
}

function downloadContent() {
    const content = scribbleArea.value;
    if (content.trim() === '') {
        alert('The scribble space is empty. Nothing to save!');
        return;
    }

    const blob = new Blob([content], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    
    const date = new Date().toISOString().slice(0, 10);
    a.download = `Scribble_Note_${date}.txt`;

    a.click();
    
    URL.revokeObjectURL(url);
    a.remove();
}

document.addEventListener('DOMContentLoaded', loadContent);
scribbleArea.addEventListener('input', saveContent);
clearButton.addEventListener('click', clearContent);
saveButton.addEventListener('click', downloadContent);